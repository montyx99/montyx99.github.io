---
title: 3D printing - Klipper gyorstalpalÃ³ (1. rÃ©sz - elmÃ©let)
layout: post
author: montyx
categories: 3d-printing
tags: klipper 3d-printing 3d-printer marlin install raspbian raspberryos
---
A Klipper nyomtatÃ³ vezÃ©rlÃ©sben 2 fontos egysÃ©g vesz rÃ©szt: a Raspberry PI Ã©s a nyomtatÃ³ alaplapja.A nyomtatÃ³ alaplapjÃ¡n van egy mikrokontroller, ami a nyomtatÃ³ Ã¶sszes szenzorÃ¡t, motorjÃ¡t, motor driverÃ©t, fÅ±tÃ©si Ã©s hÅ±tÃ©si egysÃ©geit vezÃ©rli. A Marlin firmware Ãºgy mÅ±kÃ¶dik, hogy mindent megoldjon maga az MCU (mikrokontroller). Ugyanis egy slicer Ã¡ltal elÅ‘Ã¡llÃ­tott gcode olyanokat tartalmaz, amiket mÃ©g ki kell szÃ¡molni geometriÃ¡val Ã©s elemi koordinÃ¡tÃ¡kra le kell bontani.

Na most az SWX1 agya egy 8-bites MCU, az ATMEGA2560.

| ![ATmega2560 chip](/docs/assets/atmega2560.png) | 
|:--:| 
| *ATmega2560 chip* |

Ez kb. annyit tud, mint egy alap Arduino Uno. Semmivel sem tÃ¶bbet, legalÃ¡bbis szÃ¡mÃ­tÃ¡si kapacitÃ¡sban. CserÃ©be marha sok lÃ¡ba van.

| ![ATmega328 chip](/docs/assets/atmega328p.png) | 
|:--:| 
| *ATmega328 chip* |

AzÃ©rt lÃ¡tszik a lÃ¡bmennyisÃ©gben a kÃ¼lÃ¶nbsÃ©g szerintem.

TehÃ¡t ezek 8bitesek. Lassan tudjÃ¡k feldolgozni az aritmetikai mÅ±veleteket, ezÃ©rt bonyolult kialakÃ­tÃ¡sÃº (delta, coreXY stb), vagy gyors nyomtatÃ³k vezÃ©rlÃ©sÃ©re Ã¶nmagÃ¡ban alkalmatlanok. A bonyolult nyomtatÃ³knÃ¡l az a gond, hogy ami a gcode-nak x y Ã©s z koordinÃ¡ta, az a nyomtatÃ³nak XY, XZ, YZ kettÅ‘s koordinÃ¡ta lesz, mert egyszerre kÃ©t motort kell egyenes mozgÃ¡shoz mozgatnia. (Persze ez nagyon le van egyszerÅ±sÃ­tve, mert hosszÃº tÃ©ma lenne) Ã­gy mÃ©g ezeket a szÃ¡mÃ­tÃ¡sokat is el kell vÃ©geznie egy 8bites MCUnak. Kb. ezÃ©rt voltak nagyon kicsik Ã©s lassÃºak a rÃ©gi deltÃ¡k.

Na most egy alaplap, az nem mÃ¡s, mint valamilyen Ã©rtelmezhetÅ‘ formÃ¡ban ezeket a lÃ¡bakat kivezetni a kÃ¼lÃ¶nbÃ¶zÅ‘ funkciÃ³khoz. Pl. hasraÃ¼tve a 13-as pin lesz a bltouch Ã©rzÃ©kelÅ‘ vezetÃ©ke. Ez azÃ©rt szÃ¼ksÃ©ges, mert kellenek az MCU mellÃ© kÃ­sÃ©rÅ‘ dolgok, mint kvarcok, meg ellenÃ¡llÃ¡sok, diÃ³dÃ¡k, stb. Illetve azÃ©rt, hogy vÃ©rpistike rÃ¡ tudjon dugni egy csatlakozÃ³t, ne kelljen forrasztgatnia. A kis lÃ¡bakra nem lenne tÃºl egyszerÅ± ugye dugdosni egy motor driver Ã¶sszes lÃ¡bÃ¡t. ðŸ˜ƒ

No Ã©s akkor itt jÃ¶n a Marlin, ami nem csinÃ¡l mÃ¡st, mint megmondja a nyomtatÃ³nak, hogy most az egyik motor balra, vagy jobbra tekerjen, az azt jelenti, hogy mittomÃ©n a 47-49 pinek ilyen, meg olyen Ã¡llapotba kerÃ¼ljenek. TehÃ¡t emberi olvashatÃ³ nyelvrÅ‘l lefordÃ­tja az MCU nyelvÃ©re a kÃ³dot, ami Ã©rtelmezni tudja a kapott gcode-ot Ã©s vezÃ©relni tudja a benne lÃ©vÅ‘ egysÃ©geket. Ami a gond, hogy ugye mivel MCU-n fut, Ã­gy tud elÃ©g nagy szÃ­vÃ¡s lenni a fordÃ­tÃ¡sa Ã©s flashelÃ©se. Ami azÃ©rt is veszÃ©lyes mÅ±velet, mert rossz kÃ³d esetÃ©n akÃ¡r ki is Ã©gethet alkatrÃ©szeket a boardon, vagy magÃ¡n az MCU-n. Ezt persze a Marlin Ã­rÃ³i igyekeztek levÃ©deni, de vannak tehetsÃ©ges prÃ³bÃ¡lkozÃ³k mindig.

A Marlin igazi erÅ‘ssÃ©ge a 32bites MCUkon jÃ¶n ki. Ezekre pÃ©lda az STM32 gyÃ¡rtÃ³ 32bites csipjei, melyeket elÅ‘szeretettel hasznÃ¡lnak 32bites vezÃ©rlÅ‘kÃ¶n. AzÃ©rt ezeken pÃ¶rÃ¶g a Marlin, mert sokkal gyorsabban vÃ©gzik el a szÃ¼ksÃ©ges aritmetikai Ã©s matematikai mÅ±veleteket, mint a 8bites tÃ¡rsaik.

No akkor jÃ¶jjÃ¶n a hosszas bevezetÅ‘ utÃ¡n a Klipper. Van ugye egy RPInk. Legyen mondjuk egy RPI4. Ez bÃ¡rmelyik alaplapban talÃ¡lhatÃ³ MCUhoz kÃ©pest egy atomerÅ‘mÅ±. De tÃ©nyleg. Egy rÃ©gebbi laptopnak simÃ¡n megfelel a szÃ¡mÃ­tÃ¡si kapacitÃ¡sa, teljes Ã©rtÃ©kÅ± GUIval rendelkezÅ‘ linux OS fut rajta rÃ¶ccenÃ©s nÃ©lkÃ¼l. AmÃ­g az MCU kb. sorfolytonos kÃ³dokat tud majdcsak Ã©rtelmezni, addig a 4 magos chippel szerelt RPI ugye konkurrens szÃ¡lkezelÃ©ssel megtÃ¡mogatott kÃ³dbÃ¡zisra Ã©pÃ¼lt. TehÃ¡t gÃ¶rdeszka vs. Porsche Carrera GT.

Ami tÃ¶rtÃ©nik a Klipper telepÃ­tÃ©sekor az az, hogy egy nagy halom Python kÃ³d kerÃ¼l az RPI-re. A Klipper "szerveroldala" viccesen mondva. TehÃ¡t maga a Klipper gcode Ã©rtelmezÅ‘ motorja, az Octoprint, vagy Moonraker server backend Ã©s a kÃ©t UI, a fluidd, vagy a Mainsail egyike. Az Octoprint Ã©s a Moonraker abban kÃ¼lÃ¶nbÃ¶zik, hogy az elÅ‘bbi egy teljes 3D printer manager szerveroldali app. MilliÃ³ plugin, de magÃ¡tÃ³l csak valamely RepRap alapÃº firmwares (pl marlin) gÃ©ppel tud Ã¶sszepofÃ¡zni. TehÃ¡t Ã¶nmagÃ¡ban az Octo nem szÃ¡mol semmit sem!!!!!!! Az octo arra jÃ³ pl, hogy bÃ¶ngÃ©szÅ‘bÅ‘l tudod etetni a nyomtatÃ³dat gcode fÃ¡jllal. Nem kell azt SD kÃ¡rtyÃ¡ra mÃ¡solnod Ã©s megdugni vele a nyomtatÃ³t. Meg persze ezen kÃ­vÃ¼l sok mindent. De a lÃ©nyeg, hogy tovÃ¡bbra is valamely komplex firmware fut a nyomtatÃ³don. Viszont a Klipper eredetileg egy Octoprint pluginkÃ©nt indult, hogy a szÃ¡mÃ­tÃ¡st a gÃ¶rdeszkÃ¡rÃ³l a Porschera tegye Ã¡t.

Itt jÃ¶tt a kÃ©pbe a Moonraker, ugyanis sokan, kÃ¶ztÃ¼k Ã©n is Ãºgy gondoltÃ¡k, hogy az Octo tÃ¶k feleslegesen van agyon csillivillizve mindenfÃ©le kiegÃ©szÃ­tÅ‘vel. FelÃ©t nem hasznÃ¡lja az ember. Pont annyi Ã©rdekli, amit a klipper magÃ¡ban is tud. Erre pÃ¡r okos megÃ­rta azt a rÃ©szt az OctobÃ³l, ami kell ahhoz, hogy a klipper magÃ¡ban is mÅ±kÃ¶djÃ¶n. Kis kÃ³d Ã©s script, illetve macro Ã©rtelemezÅ‘, illetve Å‘ nyÃºjtja a webes UI szÃ¡mÃ¡ra szÃ¼ksÃ©ges webes API vÃ©gpontokat is. Ezen kÃ­vÃ¼l tudja az MQTT-t, a Home Assistant integrÃ¡ciÃ³t, kÃ¼lÃ¶nbÃ¶zÅ‘ tÃ¡voli eszkÃ¶zÃ¶k managementkÃ©t, mint pl. TP-Link Ã©s Tasmota smart plugokat stb. De semmi tÃ¶bbet. Egy marha minimalista cucc. Csak a szÃ¼ksÃ©ges minimumot tudja. A mainsail, meg a fluidd pedig kÃ©t kÃ¶nnyen hasznÃ¡lhatÃ³ bÃ¶ngÃ©szÅ‘s felÃ¼let a klipperhez. Ennyi, nem tÃ¶bb.

No Ã©s akkor hol a fenÃ©ben van a nyomtatÃ³ alaplap firmware a Klipper esetÃ©ben? HÃ¡t ott, hogy a Klipper nem csak "szerveroldali", hanem nyomtatÃ³ oldali is. A Klipper telepÃ­tÃ©se sorÃ¡n meg kell mondani, hogy az RPI hogy Ã©ri el az alaplapot (Pl. USB), milyen csip van a boardon (atmega, stm32 stb.) Ã©s az alapjÃ¡n fordÃ­t egy halÃ¡l buta firmware-t. Ez leegyszerÅ±sÃ­tve csak annyit tud kb., hogy az MCU melyik PINjÃ©re, lÃ¡bÃ¡ra mikor kell feszÃ¼ltsÃ©get adni, vagy onnan kiolvasni a jelenlegi Ã©rtÃ©ket. Nem tudja, hogy vannak rÃ¡dugva szenzorok, driverek, motorok stb. Csak annyi, hogy most kÃ©rlek az analÃ³g 37es PIN kerÃ¼ljÃ¶n HIGH Ã¡llapotban Ã©s utÃ¡na a digitÃ¡lis 23as PIN Ã©rtÃ©kÃ©t olvasd be.

A tÃ¶bbit a Moonraker Ã©s fÅ‘leg a Klipper csinÃ¡lja. A kÃ¼lÃ¶nbÃ¶zÅ‘ makrÃ³kat Ã©rtelmezi a Moonraker, a kÃ¼lÃ¶nbÃ¶zÅ‘ gcode-okat pedig a klipper. A kettÅ‘t a Klipper Ã¶sszegyÃºrja Ã©s a Moonraker kitolja az utasÃ­tÃ¡sokat USB-n az alaplapra, majd a kapott vÃ¡laszt kiolvassa Ã©s egyÃ¼tt Ã©rtelmezik. Mindezt az RPI csip sebessÃ©gÃ©vel.

EzÃ©rt Ã¡ltalÃ¡ban felesleges 8bitesnÃ©l jobb alaplap, ha van Klipper, mert nem terheljÃ¼k az MCU-t kb . semmivel. EgyedÃ¼l akkor jÃ¶n jÃ³l egy 32bites, ha mÃ¡r kevÃ©s a lÃ¡b. A 32bites csipeken akÃ¡r 2-4x annyi lÃ¡b van, mint egy atmega2560on. EzÃ©rt lehet pl. 8 db motor driver rajtuk.

NagyjÃ¡bÃ³l ezek lennÃ©nek az elmÃ©leti alapok. A kÃ¶vetkezÅ‘ rÃ©szben Ã­rok egy rÃ¶vid Ã©s tÃ¶mÃ¶r telepÃ­tÃ©st, ahogy Ã©n a legegyszerÅ±bbnek tartom jelenleg a Klipper multi-instance telepÃ­tÃ©sÃ©t Ã©s karbantartÃ¡sÃ¡t. A kommentekben, vagy Facebookon a magyar 3D printer csoportokban megtalÃ¡ltok a kÃ©rdÃ©seitekkel.

A nyomi legyen veletek!

[Back >>](/index.html)